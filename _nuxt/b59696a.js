(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{1062:function(e,t,n){"use strict";n(999)},1063:function(e,t,n){var r=n(18)(!1);r.push([e.i,".video-container[data-v-59535435]{position:relative}.cam-overlay[data-v-59535435]{display:block;position:absolute;width:100%;height:100%;top:0;left:0}.config-camera-float-button[data-v-59535435]{display:inline;position:absolute;margin-top:-38px;right:20px}.display-panel[data-v-59535435]{border-radius:8px;background-color:#333;overflow:hidden;margin-top:15px;display:flex}.display-panel .display-image[data-v-59535435]{margin:0}.display-panel .display-image canvas[data-v-59535435]{min-height:180px;height:180px;width:100%;-o-object-fit:cover;object-fit:cover}.liveview[data-v-59535435]{margin:2em 1em}",""]),e.exports=r},938:function(e,t,n){"use strict";n.r(t);n(6),n(3),n(8),n(4),n(9);var r=n(30),c=n(0),o=n(1),d=(n(25),n(107),n(78),n(2),n(46),n(7),n(20),n(165),n(15),n(1060)),l=n(5);function v(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function h(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?v(Object(source),!0).forEach((function(t){Object(c.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):v(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var f={thumb:[0,1,2,3,4],indexFinger:[0,5,6,7,8],middleFinger:[0,9,10,11,12],ringFinger:[0,13,14,15,16],pinky:[0,17,18,19,20]},m={components:{},props:{source:{type:String,default:""},width:{type:[String,Number],default:260},height:{type:[String,Number],default:"100%"},simulator:{type:Boolean,default:!0}},data:function(){return{captureDevices:[],currentCaptureDeviceIndex:0,canvas:null,overlay_canvas:null,cameraReady:!1,running:!1,detector:null,currentHand:null}},created:function(){"ROBOT"==this.currentDevice&&(this.captureDevices.push(this.streamUrl+"?topic=/output/image_raw&type=ros_compressed"),this.$emit("started"))},mounted:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,tf.setBackend("webgl");case 2:return n=d.a.MediaPipeHands,r={runtime:"mediapipe",modelType:"full",solutionPath:"https://cdn.jsdelivr.net/npm/@mediapipe/hands/"},t.next=6,d.b(n,r);case 6:e.detector=t.sent;case 7:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){console.log("beforeDestroy"),this.running=!1},computed:h(h({},Object(l.e)(["currentDevice","initialDevice","streamUrl"])),{},{deviceType:function(){var e=this.captureDevices[this.currentCaptureDeviceIndex];return e&&(64!=e.length||e.startsWith("http"))?e.startsWith("http")?"STREAM":"SIM"==e?"SIM":void 0:"WEBCAM"},captureDevice:function(){return console.log("capture device change"),Array.isArray(this.captureDevices)&&this.captureDevices.length>0?this.captureDevices[this.currentCaptureDeviceIndex]:null}}),methods:{getHand:function(){return this.currentHand},getSerializedKeypoint:function(){if(this.currentHand)return this.serializeHand(this.currentHand.keypoints)},delay:function(e){return new Promise((function(t){setTimeout((function(){t("")}),e)}))},onAi:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.running?(e.running=!1,e.$nextTick(Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.delay(1e3);case 2:e.clearOverlay();case 3:case"end":return t.stop()}}),t)}))))):(e.running=!0,e.initOverlay(),e.$nextTick(Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.detect();case 2:case"end":return t.stop()}}),t)})))));case 1:case"end":return t.stop()}}),t)})))()},detect:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var video,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:video=e.$refs.webcam.$el,console.log("running");case 2:if(!e.running){t.next=19;break}return t.prev=3,t.next=6,e.detector.estimateHands(video);case 6:return(n=t.sent).length?(e.drawHands(n),e.currentHand=n[0]):(e.clearOverlay(),e.currentHand=null),t.next=10,e.delay(50);case 10:t.next=17;break;case 12:return t.prev=12,t.t0=t.catch(3),console.log(t.t0),t.next=17,e.delay(1e3);case 17:t.next=2;break;case 19:console.log("terminated");case 20:case"end":return t.stop()}}),t,null,[[3,12]])})))()},initOverlay:function(){this.overlayCanvas=document.getElementById("overlay-camera"),this.overlayCtx=this.overlayCanvas.getContext("2d"),this.resizeOverlay()},resizeOverlay:function(){null==this.overlayCtx&&this.initOverlay();var video=this.$refs.webcam.$el,e=video.clientWidth,t=video.clientHeight;this.overlayCanvas.width=e,this.overlayCanvas.height=t;var n=video.videoWidth,r=video.videoHeight;this.overlayCtx.scale(e/n,t/r)},clearOverlay:function(){var video=this.$refs.webcam.$el;this.overlayCtx.clearRect(0,0,video.videoWidth,video.videoHeight)},drawHands:function(e){this.clearOverlay(),this.drawHandKeypoints(this.overlayCtx,e[0].keypoints,e[0].handedness)},drawHandKeypoints:function(e,t,n){var r=t;e.fillStyle="Left"===n?"Red":"Blue",e.strokeStyle="White",e.lineWidth=3;for(var c=Object.keys(f),i=0;i<c.length;i++){var o=c[i],d=f[o].map((function(e){return t[e]}));this.drawPath(e,d,!1)}for(var l=0;l<r.length;l++){var v=r[l].x,h=r[l].y;this.drawPoint(e,h,v,6)}},drawPath:function(e,t,n){var r=new Path2D;r.moveTo(t[0].x,t[0].y);for(var i=1;i<t.length;i++){var c=t[i];r.lineTo(c.x,c.y)}n&&r.closePath(),e.stroke(r)},drawPoint:function(e,t,n,r){e.beginPath(),e.arc(n,t,r,0,2*Math.PI),e.fill()},onCameras:function(e){this.captureDevices=[].concat(Object(r.a)(this.captureDevices),Object(r.a)(e.map((function(e){return e.deviceId})))),this.currentCaptureDeviceIndex=0,console.log("capture devices : ",e.length)},onStarted:function(){"WEBCAM"==this.deviceType&&this.$emit("started"),this.cameraReady=!0},onStoped:function(){"WEBCAM"==this.deviceType&&this.$emit("stoped"),this.cameraReady=!1},nextCamera:function(){this.currentCaptureDeviceIndex++,this.currentCaptureDeviceIndex>=this.captureDevices.length&&(this.currentCaptureDeviceIndex=0),console.log("change camera to : ",this.captureDevices[this.currentCaptureDeviceIndex]),"WEBCAM"==this.deviceType?this.$refs.webcam.changeCamera(this.captureDevices[this.currentCaptureDeviceIndex]):"STREAM"==this.deviceType&&(console.log("start stream"),this.$emit("started")),this.ctx=null},snap:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var image;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.captureWithHand();case 2:return image=t.sent,t.abrupt("return",image);case 4:case"end":return t.stop()}}),t)})))()},canvasToBlob:function(canvas){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/jpeg",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8;return new Promise((function(n,r){canvas.toBlob((function(e){e?n(e):r()}),e,t)}))},serializeHand:function(e){if(21!==e.length)return null;for(var t=[],i=1;i<21;i++){var n=e[0].x-e[i].x,r=e[0].y-e[i].y;t.push(n),t.push(r)}return t},captureWithHand:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n,r,c,o,d,canvas,l,v,image;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"WEBCAM"==e.deviceType?(n=e.$refs.webcam.$refs.video,r=n.videoWidth,c=n.videoHeight):"STREAM"!=e.deviceType&&"SIM"!=e.deviceType||(n=e.$refs.displayImage,r=n.clientWidth,c=n.clientHeight),e.ctx||((o=document.createElement("canvas")).height=c,o.width=r,e.canvas=o,e.ctx=o.getContext("2d")),d=e.ctx,canvas=e.canvas,d.drawImage(n,0,0,canvas.width,canvas.height),l=null,v=null,e.currentHand&&(l=e.serializeHand(e.currentHand.keypoints),v=e.currentHand.handedness,e.drawHandKeypoints(d,e.currentHand.keypoints,e.currentHand.handedness)),t.next=9,e.canvasToBlob(canvas);case 9:return image=t.sent,t.abrupt("return",{image:image,keypoints:l,handedness:v,thumbnail:null,width:canvas.width,height:canvas.height});case 11:case"end":return t.stop()}}),t)})))()}}},y=m,w=(n(1062),n(11)),component=Object(w.a)(y,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"display-panel liveview"},[n("div",{staticClass:"config-camera-float-button"},[n("b-avatar",{attrs:{disabled:!e.cameraReady,icon:e.running?"pause":"play",size:32,button:""},on:{click:e.onAi}}),e._v(" "),e.simulator?n("b-avatar",{attrs:{icon:"box",size:32,button:""},on:{click:function(t){return e.$emit("openSim")}}}):e._e(),e._v(" "),e.captureDevices.length>1?n("b-avatar",{attrs:{icon:"arrow-repeat",size:32,button:""},on:{click:e.nextCamera}}):e._e()],1),e._v(" "),"STREAM"==e.deviceType?n("div",[n("b-img",{ref:"displayImage",attrs:{crossorigin:"anonymous",width:e.width,src:e.captureDevices[e.currentCaptureDeviceIndex]}})],1):e._e(),e._v(" "),n("div",{staticClass:"video-container"},[n("vue-web-cam",{directives:[{name:"show",rawName:"v-show",value:"STREAM"!=e.deviceType,expression:"deviceType != 'STREAM'"}],ref:"webcam",attrs:{width:e.width,height:e.height,deviceId:e.captureDevice},on:{cameras:e.onCameras,started:e.onStarted,stopped:e.onStoped}}),e._v(" "),n("canvas",{ref:"overlay",staticClass:"cam-overlay",attrs:{id:"overlay-camera"}})],1)])}),[],!1,null,"59535435",null);t.default=component.exports},977:function(e,t){},978:function(e,t){},985:function(e,t){},999:function(e,t,n){var content=n(1063);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(19).default)("709c3ab4",content,!0,{sourceMap:!1})}}]);