(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{1e3:function(e,t,r){var content=r(1067);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(19).default)("f6f053ca",content,!0,{sourceMap:!1})},1066:function(e,t,r){"use strict";r(1e3)},1067:function(e,t,r){var n=r(18)(!1);n.push([e.i,".video-container[data-v-d4418610]{position:relative}.cam-overlay[data-v-d4418610]{display:block;position:absolute;width:100%;height:100%;top:0;left:0}.config-camera-float-button[data-v-d4418610]{display:inline;position:absolute;margin-top:-38px;right:20px}.display-panel[data-v-d4418610]{border-radius:8px;background-color:#333;overflow:hidden;margin-top:15px;display:flex}.display-panel .display-image[data-v-d4418610]{margin:0}.display-panel .display-image canvas[data-v-d4418610]{min-height:180px;height:180px;width:100%;-o-object-fit:cover;object-fit:cover}.liveview[data-v-d4418610]{margin:2em 1em}",""]),e.exports=n},939:function(e,t,r){"use strict";r.r(t);r(7),r(6),r(3),r(8),r(9),r(21),r(26),r(41),r(34),r(14),r(42),r(47),r(35);var n=r(30),o=r(40),c=r(0),l=r(1),d=(r(25),r(107),r(78),r(2),r(46),r(165),r(4),r(15),r(20),r(1064)),v=r(5);function h(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return f(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return f(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,n=function(){};return{s:n,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,c=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){l=!0,o=e},f:function(){try{c||null==r.return||r.return()}finally{if(l)throw o}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function y(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function m(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?y(Object(source),!0).forEach((function(t){Object(c.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):y(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var w={components:{},props:{source:{type:String,default:""},width:{type:[String,Number],default:260},height:{type:[String,Number],default:"100%"},simulator:{type:Boolean,default:!0}},data:function(){return{captureDevices:[],currentCaptureDeviceIndex:0,canvas:null,overlay_canvas:null,cameraReady:!1,running:!1,detector:null,currentPose:null}},mounted:function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,tf.setBackend("webgl");case 2:return r=d.a.MoveNet,n={runtime:"mediapipe",modelType:d.c.modelType.SINGLEPOSE_LIGHTNING,solutionPath:"https://cdn.jsdelivr.net/npm/@mediapipe/pose/"},t.next=6,d.b(r,n);case 6:e.detector=t.sent;case 7:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){console.log("beforeDestroy"),this.running=!1},computed:m(m({},Object(v.e)(["currentDevice","initialDevice","streamUrl"])),{},{deviceType:function(){var e=this.captureDevices[this.currentCaptureDeviceIndex];return e&&(64!=e.length||e.startsWith("http"))?e.startsWith("http")?"STREAM":"SIM"==e?"SIM":void 0:"WEBCAM"},captureDevice:function(){return console.log("capture device change"),Array.isArray(this.captureDevices)&&this.captureDevices.length>0?this.captureDevices[this.currentCaptureDeviceIndex]:null}}),methods:{getPose:function(){return this.currentPose},getSerializedKeypoint:function(){if(this.currentPose)return this.serializeKeypoint(this.currentPose.keypoints)},delay:function(e){return new Promise((function(t){setTimeout((function(){t("")}),e)}))},onAi:function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.running?(e.running=!1,e.$nextTick(Object(l.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.delay(1e3);case 2:e.clearOverlay();case 3:case"end":return t.stop()}}),t)}))))):(e.running=!0,e.initOverlay(),e.$nextTick(Object(l.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.detect();case 2:case"end":return t.stop()}}),t)})))));case 1:case"end":return t.stop()}}),t)})))()},detect:function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){var video,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:video=e.$refs.webcam.$el,console.log("running");case 2:if(!e.running){t.next=19;break}return t.prev=3,t.next=6,e.detector.estimatePoses(video);case 6:return(r=t.sent).length?(e.drawPose(r[0]),e.currentPose=r[0]):(e.clearOverlay(),e.currentPose=null),t.next=10,e.delay(50);case 10:t.next=17;break;case 12:return t.prev=12,t.t0=t.catch(3),console.log(t.t0),t.next=17,e.delay(1e3);case 17:t.next=2;break;case 19:console.log("terminated");case 20:case"end":return t.stop()}}),t,null,[[3,12]])})))()},initOverlay:function(){this.overlayCanvas=document.getElementById("overlay-camera"),this.overlayCtx=this.overlayCanvas.getContext("2d"),this.resizeOverlay()},resizeOverlay:function(){null==this.overlayCtx&&this.initOverlay();var video=this.$refs.webcam.$el,e=video.clientWidth,t=video.clientHeight;this.overlayCanvas.width=e,this.overlayCanvas.height=t;var r=video.videoWidth,n=video.videoHeight;this.overlayCtx.scale(e/r,t/n)},clearOverlay:function(){var video=this.$refs.webcam.$el;this.overlayCtx.clearRect(0,0,video.videoWidth,video.videoHeight)},drawPose:function(e){this.clearOverlay(),null!=e.keypoints&&(this.drawKeypoints(this.overlayCtx,e.keypoints),this.drawSkeleton(this.overlayCtx,e.keypoints,e.id))},drawKeypoints:function(e,t){var r=d.d.getKeypointIndexBySide(d.a.MoveNet);e.fillStyle="Red",e.strokeStyle="White",e.lineWidth=4;var n,o=h(r.middle);try{for(o.s();!(n=o.n()).done;){var i=n.value;this.drawKeypoint(e,t[i])}}catch(e){o.e(e)}finally{o.f()}e.fillStyle="Green";var c,l=h(r.left);try{for(l.s();!(c=l.n()).done;){var v=c.value;this.drawKeypoint(e,t[v])}}catch(e){l.e(e)}finally{l.f()}e.fillStyle="Orange";var f,y=h(r.right);try{for(y.s();!(f=y.n()).done;){var m=f.value;this.drawKeypoint(e,t[m])}}catch(e){y.e(e)}finally{y.f()}},drawKeypoint:function(e,t){if((null!=t.score?t.score:1)>=.3){var circle=new Path2D;circle.arc(t.x,t.y,5,0,2*Math.PI),e.fill(circle),e.stroke(circle)}},drawSkeleton:function(e,t,r){var n="White";e.fillStyle=n,e.strokeStyle=n,e.lineWidth=4,d.d.getAdjacentPairs(d.a.MoveNet).forEach((function(r){var n=Object(o.a)(r,2),i=n[0],c=n[1],l=t[i],d=t[c],v=null!=l.score?l.score:1,h=null!=d.score?d.score:1;v>=.3&&h>=.3&&(e.beginPath(),e.moveTo(l.x,l.y),e.lineTo(d.x,d.y),e.stroke())}))},onCameras:function(e){this.captureDevices=[].concat(Object(n.a)(this.captureDevices),Object(n.a)(e.map((function(e){return e.deviceId})))),this.currentCaptureDeviceIndex=0,console.log("capture devices : ",e.length)},onStarted:function(){"WEBCAM"==this.deviceType&&this.$emit("started"),this.cameraReady=!0},onStoped:function(){"WEBCAM"==this.deviceType&&this.$emit("stoped"),this.cameraReady=!1},nextCamera:function(){this.currentCaptureDeviceIndex++,this.currentCaptureDeviceIndex>=this.captureDevices.length&&(this.currentCaptureDeviceIndex=0),console.log("change camera to : ",this.captureDevices[this.currentCaptureDeviceIndex]),"WEBCAM"==this.deviceType?this.$refs.webcam.changeCamera(this.captureDevices[this.currentCaptureDeviceIndex]):"STREAM"==this.deviceType&&(console.log("start stream"),this.$emit("started")),this.ctx=null},snap:function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){var image;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.captureWithPose();case 2:return image=t.sent,t.abrupt("return",image);case 4:case"end":return t.stop()}}),t)})))()},canvasToBlob:function(canvas){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/jpeg",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8;return new Promise((function(r,n){canvas.toBlob((function(e){e?r(e):n()}),e,t)}))},serializeKeypoint:function(e){if(17!==e.length)return null;for(var t=[],i=1;i<17;i++){var r=e[0].x-e[i].x,n=e[0].y-e[i].y;t.push(r),t.push(n)}return t},captureWithPose:function(){var e=this;return Object(l.a)(regeneratorRuntime.mark((function t(){var r,n,o,c,l,canvas,d,v,image;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"WEBCAM"==e.deviceType?(r=e.$refs.webcam.$refs.video,n=r.videoWidth,o=r.videoHeight):"STREAM"!=e.deviceType&&"SIM"!=e.deviceType||(r=e.$refs.displayImage,n=r.clientWidth,o=r.clientHeight),e.ctx||((c=document.createElement("canvas")).height=o,c.width=n,e.canvas=c,e.ctx=c.getContext("2d")),l=e.ctx,canvas=e.canvas,l.drawImage(r,0,0,canvas.width,canvas.height),d=null,v=0,e.currentPose&&(d=e.serializeKeypoint(e.currentPose.keypoints),v=e.currentPose.id,e.drawKeypoints(l,e.currentPose.keypoints),e.drawSkeleton(l,e.currentPose.keypoints,e.currentPose.id)),t.next=9,e.canvasToBlob(canvas);case 9:return image=t.sent,t.abrupt("return",{image:image,keypoints:d,poseId:v,thumbnail:null,width:canvas.width,height:canvas.height});case 11:case"end":return t.stop()}}),t)})))()}}},x=w,O=(r(1066),r(11)),component=Object(O.a)(x,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"display-panel liveview"},[r("div",{staticClass:"config-camera-float-button"},[r("b-avatar",{attrs:{disabled:!e.cameraReady,icon:e.running?"pause":"play",size:32,button:""},on:{click:e.onAi}}),e._v(" "),e.simulator?r("b-avatar",{attrs:{icon:"box",size:32,button:""},on:{click:function(t){return e.$emit("openSim")}}}):e._e(),e._v(" "),e.captureDevices.length>1?r("b-avatar",{attrs:{icon:"arrow-repeat",size:32,button:""},on:{click:e.nextCamera}}):e._e()],1),e._v(" "),"STREAM"==e.deviceType?r("div",[r("b-img",{ref:"displayImage",attrs:{crossorigin:"anonymous",width:e.width,src:e.captureDevices[e.currentCaptureDeviceIndex]}})],1):e._e(),e._v(" "),r("div",{staticClass:"video-container"},[r("vue-web-cam",{directives:[{name:"show",rawName:"v-show",value:"STREAM"!=e.deviceType,expression:"deviceType != 'STREAM'"}],ref:"webcam",attrs:{width:e.width,height:e.height,deviceId:e.captureDevice},on:{cameras:e.onCameras,started:e.onStarted,stopped:e.onStoped}}),e._v(" "),r("canvas",{ref:"overlay",staticClass:"cam-overlay",attrs:{id:"overlay-camera"}})],1)])}),[],!1,null,"d4418610",null);t.default=component.exports},977:function(e,t){},978:function(e,t){},985:function(e,t){}}]);