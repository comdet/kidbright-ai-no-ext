!function(e){var t={};function o(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(object,e){return Object.prototype.hasOwnProperty.call(object,e)},o.p="/_nuxt/",o(o.s=0)}([function(module,exports){importScripts("https://cdn.jsdelivr.net/npm/@tensorflow/tfjs");let processing=!1,sourceCode="";const MAX_BOXES=10;let __model=null,__anchors=[],__labels=[],__image=null,__data=null,__bboxes=[],__iouth=.5,__objth=.5,responseCallback=null,requestCommand=null;const requestData=async function(e,t){requestCommand=e;let o={command:"REQUEST",data:e};t&&(o=Object.assign(o,t)),postMessage(o);let n=new Promise((e=>responseCallback=e));return await n},loadingModel=async function(){let e=await requestData("MODEL");__model=await tf.loadLayersModel(tf.io.fromMemory(e.modelJson.modelTopology,e.modelJson.weightsManifest[0].weights,e.weight))},initModel=async function(e,t){__iouth=e,__objth=t,postMessage({command:"PRINT",msg:"Loading model\r\n"}),await loadingModel(),postMessage({command:"PRINT",msg:"Loading labels\r\n"}),postMessage({command:"PRINT",msg:"Label : "+__labels.join(",")+"\r\n"}),postMessage({command:"PRINT",msg:"Anchors : "+__anchors.join(",")+"\r\n"});let o=__model.layers[0].inputSpec[0].shape;postMessage({command:"PRINT",msg:"Model Input Shape : "+o.join(",")+"\r\n"}),postMessage({command:"PRINT",msg:"Preloading model\r\n"});const n=tf.zeros([1,o[1],o[2],o[3]],"int32"),r=await __model.predict(n);await r.data();r.dispose(),n.dispose(),postMessage({command:"PRINT",msg:"Preload model success\r\n"}),postMessage({command:"PRINT",msg:"Model loaded\r\n"})},__detect=async function(img,e,t){let o=__model.layers[0].inputSpec[0].shape;const n=tf.tidy((()=>{const e=tf.add(tf.mul(tf.cast(img,"float32"),2/255),-1);let t=tf.image.resizeBilinear(e,[o[1],o[2]],!0);return tf.reshape(t,[-1,o[1],o[2],3])}));let r=await __model.predict(n);return await postProcess(r,__anchors,__labels.length,__labels,[img.shape[0],img.shape[1]],MAX_BOXES,e,t)},detect=async function(){__image=await requestData("IMAGE");let e=await tf.browser.fromPixels(__image);__bboxes=await __detect(e,__objth,__iouth),postMessage({command:"RESULT",data:__bboxes})},process=function(){try{eval(sourceCode)}catch(e){postMessage({command:"PRINT",msg:"ERROR !!! \r\n"+e.message})}};onmessage=async e=>{"RUN"==e.data.command?(sourceCode=e.data.code,__labels=e.data.labels,__anchors=e.data.anchors,processing||(processing=!0,process())):"RESPONSE"==e.data.command&&e.data.subcommand==requestCommand&&responseCallback(e.data.data)};const yoloHead=function(e,t,o,n){const r=t.shape[0],c=tf.reshape(t,[1,1,r,2]),l=e.shape.slice(1,3),d=tf.tile(tf.reshape(tf.range(0,l[0]),[-1,1,1,1]),[1,l[1],1,1]),f=tf.tile(tf.reshape(tf.range(0,l[1]),[1,-1,1,1]),[l[0],1,1,1]),m=tf.concat([f,d],3).cast(e.dtype);e=e.reshape([l[0],l[1],r,o+5]);const[_,h,y,M]=tf.split(e,[2,2,1,o],3);return[tf.div(tf.add(tf.sigmoid(_),m),l.reverse()),tf.div(tf.mul(tf.exp(h),c),n.reverse()),tf.sigmoid(y),tf.softmax(M)]},yoloCorrectBoxes=function(e,t,o){const n=tf.concat(tf.split(e,2,3).reverse(),3),r=tf.concat(tf.split(t,2,3).reverse(),3),c=tf.mul(tf.sub(n,tf.div(r,2)),o),l=tf.mul(tf.add(n,tf.div(r,2)),o);return tf.concat([...tf.split(c,2,3),...tf.split(l,2,3)],3)},yoloBoxesAndScores=function(e,t,o,n,r){const[c,l,d,f]=yoloHead(e,t,o,n);let m=yoloCorrectBoxes(c,l,r);m=m.reshape([-1,4]);let _=tf.mul(d,f);return _=tf.reshape(_,[-1,o]),[m,_]},postProcess=async function(e,t,o,n,r,c,l,d){const[f,m]=tf.tidy((()=>{const n=tf.tensor1d(t).reshape([-1,2]),c=e.shape.slice(1,3),[l,d]=yoloBoxesAndScores(e,n,o,c,r);return[l,d]}));let _=[],h=[],y=[];const M=tf.argMax(m,-1),x=tf.max(m,-1),P=await tf.image.nonMaxSuppressionAsync(f,x,c,d,l);return P.size&&tf.tidy((()=>{const e=tf.gather(f,P),t=tf.gather(x,P);e.split(P.size).map((e=>{_.push(e.dataSync())})),t.dataSync().map((e=>{h.push(e)})),y=M.gather(P).dataSync()})),x.dispose(),M.dispose(),P.dispose(),f.dispose(),m.dispose(),_.map(((e,i)=>{const t=Math.max(0,e[0]),o=Math.max(0,e[1]),c=Math.min(r[0],e[2]),l=Math.min(r[1],e[3]),d=c-t,f=l-o;return{top:t,left:o,bottom:c,right:l,height:d,width:f,area:f*d,centerX:o+f/2,centerY:t+d/2,score:h[i],index:y[i],class:n[y[i]]}}))}}]);