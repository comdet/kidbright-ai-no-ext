(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{1058:function(e,t,r){"use strict";r(998)},1059:function(e,t,r){var n=r(18)(!1);n.push([e.i,".video-container[data-v-4d0ca155]{position:relative}.cam-overlay[data-v-4d0ca155]{display:block;position:absolute;width:100%;height:100%;top:0;left:0}.config-camera-float-button[data-v-4d0ca155]{display:inline;position:absolute;margin-top:-38px;right:20px}.display-panel[data-v-4d0ca155]{border-radius:8px;background-color:#333;overflow:hidden;margin-top:15px;display:flex}.display-panel .display-image[data-v-4d0ca155]{margin:0}.display-panel .display-image canvas[data-v-4d0ca155]{min-height:180px;height:180px;width:100%;-o-object-fit:cover;object-fit:cover}.liveview[data-v-4d0ca155]{margin:2em 1em}",""]),e.exports=n},937:function(e,t,r){"use strict";r.r(t);r(7),r(6),r(3),r(8),r(4),r(9);var n=r(30),c=r(0),o=r(1),l=(r(25),r(107),r(78),r(2),r(46),r(20),r(165),r(15),r(1026)),d=r(5);function v(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,r)}return t}function h(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?v(Object(source),!0).forEach((function(t){Object(c.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):v(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var f=468,m={components:{},props:{source:{type:String,default:""},width:{type:[String,Number],default:260},height:{type:[String,Number],default:"100%"},simulator:{type:Boolean,default:!0}},data:function(){return{captureDevices:[],currentCaptureDeviceIndex:0,canvas:null,overlay_canvas:null,cameraReady:!1,running:!1,detector:null,currentFace:null}},mounted:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,tf.setBackend("webgl");case 2:return r=l.a.MediaPipeFaceMesh,n={runtime:"mediapipe",solutionPath:"https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/"},t.next=6,l.b(r,n);case 6:e.detector=t.sent;case 7:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){console.log("beforeDestroy"),this.running=!1},computed:h(h({},Object(d.e)(["currentDevice","initialDevice","streamUrl"])),{},{deviceType:function(){var e=this.captureDevices[this.currentCaptureDeviceIndex];return e&&(64!=e.length||e.startsWith("http"))?e.startsWith("http")?"STREAM":"SIM"==e?"SIM":void 0:"WEBCAM"},captureDevice:function(){return console.log("capture device change"),Array.isArray(this.captureDevices)&&this.captureDevices.length>0?this.captureDevices[this.currentCaptureDeviceIndex]:null}}),methods:{getFace:function(){return this.currentFace},getSerializedKeypoint:function(){if(this.currentFace)return this.serializeKeypoint(this.currentFace.keypoints)},delay:function(e){return new Promise((function(t){setTimeout((function(){t("")}),e)}))},onAi:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.running?(e.running=!1,e.$nextTick(Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.delay(1e3);case 2:e.clearOverlay();case 3:case"end":return t.stop()}}),t)}))))):(e.running=!0,e.initOverlay(),e.$nextTick(Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.detect();case 2:case"end":return t.stop()}}),t)})))));case 1:case"end":return t.stop()}}),t)})))()},detect:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var video,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:video=e.$refs.webcam.$el,console.log("running");case 2:if(!e.running){t.next=19;break}return t.prev=3,t.next=6,e.detector.estimateFaces(video);case 6:return(r=t.sent).length?(e.drawFace(r[0]),e.currentFace=r[0]):(e.clearOverlay(),e.currentFace=null),t.next=10,e.delay(5);case 10:t.next=17;break;case 12:return t.prev=12,t.t0=t.catch(3),console.log(t.t0),t.next=17,e.delay(1e3);case 17:t.next=2;break;case 19:console.log("terminated");case 20:case"end":return t.stop()}}),t,null,[[3,12]])})))()},initOverlay:function(){this.overlayCanvas=document.getElementById("overlay-camera"),this.overlayCtx=this.overlayCanvas.getContext("2d"),this.resizeOverlay()},resizeOverlay:function(){null==this.overlayCtx&&this.initOverlay();var video=this.$refs.webcam.$el,e=video.clientWidth,t=video.clientHeight;this.overlayCanvas.width=e,this.overlayCanvas.height=t;var r=video.videoWidth,n=video.videoHeight;this.overlayCtx.scale(e/r,t/n)},clearOverlay:function(){var video=this.$refs.webcam.$el;this.overlayCtx.clearRect(0,0,video.videoWidth,video.videoHeight)},drawFace:function(e){this.clearOverlay(),null!=e.keypoints&&this.drawResults(this.overlayCtx,e,!1,!1)},drawResults:function(e,t){var r=t.keypoints.map((function(e){return[e.x,e.y]}));e.fillStyle="#32EEDB";for(var i=0;i<f;i++){var n=r[i][0],c=r[i][1];e.beginPath(),e.arc(n,c,1,0,2*Math.PI),e.fill()}if(r.length>f){e.strokeStyle="#FF2C35",e.lineWidth=1;var o=r[468],l=distance(r[472],r[470]),d=distance(r[471],r[469]);if(e.beginPath(),e.ellipse(o[0],o[1],d/2,l/2,0,0,2*Math.PI),e.stroke(),r.length>473){var v=r[473],h=distance(r[475],r[477]),m=distance(r[476],r[474]);e.beginPath(),e.ellipse(v[0],v[1],m/2,h/2,0,0,2*Math.PI),e.stroke()}}},onCameras:function(e){this.captureDevices=[].concat(Object(n.a)(this.captureDevices),Object(n.a)(e.map((function(e){return e.deviceId})))),this.currentCaptureDeviceIndex=0,console.log("capture devices : ",e.length)},onStarted:function(){"WEBCAM"==this.deviceType&&this.$emit("started"),this.cameraReady=!0},onStoped:function(){"WEBCAM"==this.deviceType&&this.$emit("stoped"),this.cameraReady=!1},nextCamera:function(){this.currentCaptureDeviceIndex++,this.currentCaptureDeviceIndex>=this.captureDevices.length&&(this.currentCaptureDeviceIndex=0),console.log("change camera to : ",this.captureDevices[this.currentCaptureDeviceIndex]),"WEBCAM"==this.deviceType?this.$refs.webcam.changeCamera(this.captureDevices[this.currentCaptureDeviceIndex]):"STREAM"==this.deviceType&&(console.log("start stream"),this.$emit("started")),this.ctx=null},snap:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var image;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.captureWithFaceLandmark();case 2:return image=t.sent,t.abrupt("return",image);case 4:case"end":return t.stop()}}),t)})))()},canvasToBlob:function(canvas){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/jpeg",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8;return new Promise((function(r,n){canvas.toBlob((function(e){e?r(e):n()}),e,t)}))},serializeKeypoint:function(e){if(e.length!==f)return null;for(var t=[],i=1;i<f;i++){var r=e[0].x-e[i].x,n=e[0].y-e[i].y;t.push(r),t.push(n)}return t},captureWithFaceLandmark:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var r,n,c,o,l,canvas,d,image;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"WEBCAM"==e.deviceType?(r=e.$refs.webcam.$refs.video,n=r.videoWidth,c=r.videoHeight):"STREAM"!=e.deviceType&&"SIM"!=e.deviceType||(r=e.$refs.displayImage,n=r.clientWidth,c=r.clientHeight),e.ctx||((o=document.createElement("canvas")).height=c,o.width=n,e.canvas=o,e.ctx=o.getContext("2d")),l=e.ctx,canvas=e.canvas,l.drawImage(r,0,0,canvas.width,canvas.height),d=null,e.currentFace&&(d=e.serializeKeypoint(e.currentFace.keypoints),e.drawResults(l,e.currentFace)),t.next=8,e.canvasToBlob(canvas);case 8:return image=t.sent,t.abrupt("return",{image:image,keypoints:d,thumbnail:null,width:canvas.width,height:canvas.height});case 10:case"end":return t.stop()}}),t)})))()}}},y=m,w=(r(1058),r(11)),component=Object(w.a)(y,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"display-panel liveview"},[r("div",{staticClass:"config-camera-float-button"},[r("b-avatar",{attrs:{disabled:!e.cameraReady,icon:e.running?"pause":"play",size:32,button:""},on:{click:e.onAi}}),e._v(" "),e.simulator?r("b-avatar",{attrs:{icon:"box",size:32,button:""},on:{click:function(t){return e.$emit("openSim")}}}):e._e(),e._v(" "),e.captureDevices.length>1?r("b-avatar",{attrs:{icon:"arrow-repeat",size:32,button:""},on:{click:e.nextCamera}}):e._e()],1),e._v(" "),"STREAM"==e.deviceType?r("div",[r("b-img",{ref:"displayImage",attrs:{crossorigin:"anonymous",width:e.width,src:e.captureDevices[e.currentCaptureDeviceIndex]}})],1):e._e(),e._v(" "),r("div",{staticClass:"video-container"},[r("vue-web-cam",{directives:[{name:"show",rawName:"v-show",value:"STREAM"!=e.deviceType,expression:"deviceType != 'STREAM'"}],ref:"webcam",attrs:{width:e.width,height:e.height,deviceId:e.captureDevice},on:{cameras:e.onCameras,started:e.onStarted,stopped:e.onStoped}}),e._v(" "),r("canvas",{ref:"overlay",staticClass:"cam-overlay",attrs:{id:"overlay-camera"}})],1)])}),[],!1,null,"4d0ca155",null);t.default=component.exports},977:function(e,t){},978:function(e,t){},985:function(e,t){},998:function(e,t,r){var content=r(1059);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(19).default)("3afc0264",content,!0,{sourceMap:!1})}}]);